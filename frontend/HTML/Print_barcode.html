<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Print Barcode - Lab box store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="../Assets/OHM.jpg">
    <style>
        * { font-family: 'Kanit', sans-serif; }
        body { font-family: 'Kanit', sans-serif; }
        .font-kanit { font-family: 'Kanit', sans-serif; }
        .floating-print-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 50;
        }
        .card-selected {
            border: 2px solid #3b82f6 !important;
            box-shadow: 0 0 0 4px #dbeafe !important;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 text-slate-800 font-sans">
    <div class="flex h-screen">
        <!-- ===== SIDEBAR ===== -->
        <aside 
            :class="sidebarOpen ? 'w-72' : 'w-20'"
            class="bg-white shadow-lg transition-all duration-300 ease-in-out flex flex-col border-r border-gray-200 relative"
        >
            <!-- Sidebar Header -->
            <div class="flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50">
                <div class="flex items-center gap-3">
                    <button 
                        @click="sidebarOpen = !sidebarOpen" 
                        class="p-2 rounded-lg hover:bg-gray-200 transition-colors text-gray-600 hover:text-gray-800"
                        aria-label="Toggle sidebar"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg overflow-hidden flex items-center justify-center bg-gray-100">
                            <img src="../Assets/OHM.jpg" alt="Logo" class="object-contain w-full h-full" />
                        </div>
                        <div x-show="sidebarOpen" class="transition-all duration-200">
                            <span class="text-lg font-bold bg-gradient-to-r from-yellow-400 via-amber-500 to-blue-600 bg-clip-text text-transparent labbox-animated">
                                Lab box store
                            </span>
                            <p class="text-xs text-gray-500 mt-1">Management System</p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Navigation Menu -->
            <nav class="flex-1 px-3 py-4 space-y-2">
                <a href="home"
                    :class="active === 'home' ? 'bg-blue-100 text-blue-700 border-blue-200' : 'text-gray-600 hover:bg-gray-100 hover:text-gray-800'"
                    class="flex items-center gap-3 px-3 py-2 rounded-lg border transition-colors font-medium">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v6H8V5z"></path>
                    </svg>
                    <span x-show="sidebarOpen" class="transition-all duration-200">Dashboard</span>
                </a>
                <a href="logdata"
                    :class="active === 'log' ? 'bg-blue-100 text-blue-700 border-blue-200' : 'text-gray-600 hover:bg-gray-100 hover:text-gray-800'"
                    class="flex items-center gap-3 px-3 py-2 rounded-lg border transition-colors font-medium">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <span x-show="sidebarOpen" class="transition-all duration-200">Log Data</span>
                </a>
                <a href="noti"
                    :class="active === 'noti' ? 'bg-blue-100 text-blue-700 border-blue-200' : 'text-gray-600 hover:bg-gray-100 hover:text-gray-800'"
                    class="flex items-center gap-3 px-3 py-2 rounded-lg border transition-colors font-medium">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                    </svg>
                    <span x-show="sidebarOpen" class="transition-all duration-200">Notifications</span>
                </a>
                <a href="create_barcode.html"
                    :class="active === 'create_barcode' ? 'bg-indigo-100 text-indigo-700 border-indigo-200' : 'text-gray-600 hover:bg-indigo-50 hover:text-indigo-800'"
                    class="flex items-center gap-3 px-3 py-2 rounded-lg border transition-colors font-medium">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <rect x="3" y="6" width="18" height="12" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect>
                        <line x1="7" y1="10" x2="7" y2="14" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
                        <line x1="11" y1="10" x2="11" y2="14" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
                        <line x1="15" y1="10" x2="15" y2="14" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
                    </svg>
                    <span x-show="sidebarOpen" class="transition-all duration-200">Create Barcode</span>
                </a>
                <a href="Print_barcode.html"
                    :class="active === 'print_barcode' ? 'bg-indigo-100 text-indigo-700 border-indigo-200' : 'text-gray-600 hover:bg-indigo-50 hover:text-indigo-800'"
                    class="flex items-center gap-3 px-3 py-2 rounded-lg border transition-colors font-medium">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <rect x="6" y="9" width="12" height="7" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect>
                        <path d="M6 9V6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                        <path d="M9 16h6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                    <span x-show="sidebarOpen" class="transition-all duration-200">Print Barcode</span>
                </a>
                <!-- Divider -->
                <div class="relative my-4">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-200"></div>
                    </div>
                    <div class="relative flex justify-center text-xs">
                        <span class="bg-white px-2 text-gray-500" x-show="sidebarOpen">Quick Actions</span>
                    </div>
                </div>
                <!-- Quick Action Buttons -->
                <div x-show="sidebarOpen" class="space-y-2">
                    <button id="helpButton" type="button" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg bg-sky-50 text-sky-700 hover:bg-sky-100 transition-colors font-medium border border-sky-200">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10hac01M12 14h.01M16 10h.01M12 18h.01M12 6h.01" />
                        </svg>
                        <span>Help</span>
                    </button>
                </div>
            </nav>
            <!-- Sidebar Footer -->
            <div class="p-4 border-t border-gray-200 bg-gray-50">
                <div class="flex flex-col items-center justify-center py-2">
                    <img src="../Assets/OHM.jpg" alt="School Logo" class="w-14 h-14 rounded-lg shadow mb-2" />
                    <span class="flex items-center gap-1 text-xs text-green-600 font-medium mb-1">
                        <span class="w-2 h-2 bg-green-400 rounded-full"></span> Online
                    </span>
                    <a href="https://spr.ac.th" target="_blank" rel="noopener"
                       class="mt-2 w-full flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-gradient-to-r from-sky-200 to-blue-400 text-blue-900 font-semibold shadow hover:from-blue-300 hover:to-blue-500 hover:text-white hover:shadow-lg transition-all duration-200 transform hover:scale-105 text-base sm:text-lg sm:w-auto sm:px-4 sm:py-2.5">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 4v1m0 14v1m8-8h1M4 12H3m15.364-6.364l.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M6.343 6.343l-.707-.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                        </svg>
                        <span class="truncate">Go to School Website</span>
                    </a>
                </div>
                <!-- Contact Menu -->
                <button id="contactButton" class="mt-3 w-full flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 transition-colors font-medium">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 10.5V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2h14a2 2 0 002-2v-4.5M17 8l-5 5-5-5" />
                    </svg>
                    <span>Contact</span>
                </button>
            </div>
        </aside>
        <!-- ===== MAIN CONTENT ===== -->
        <main class="flex-1 overflow-hidden">
            <header class="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
                <h1 class="text-2xl font-bold text-indigo-700">Print Barcode</h1>
            </header>
            <div class="min-h-screen relative bg-gradient-to-br from-slate-50 to-slate-100">
                <div class="p-4 sm:p-6 lg:p-8 h-full">
                    <div id="cardContainer" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4"></div>
                </div>
                <!-- Floating Print Button -->
                <div class="floating-print-btn">
                    <button id="printBtn" class="px-6 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-blue-400 text-white font-bold text-base shadow-lg hover:from-blue-600 hover:to-indigo-600 hover:scale-105 transition-all duration-200 flex items-center gap-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="6" y="9" width="12" height="7" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M6 9V6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M9 16h6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                        Print
                    </button>
                </div>
            </div>
        </main>
    </div>
    <script>
    let chemicals = [];
    let printMode = false;
    window.Printing_barcode = null;

    // Fetch all chemicals (simulate API, replace with real API if needed)
    async function fetchChemicals() {
        try {
            const res = await fetch('/Storage');
            chemicals = await res.json();
            renderCards();
        } catch (e) {
            document.getElementById('cardContainer').innerHTML = '<div class="col-span-full text-center text-red-500">Failed to load chemicals</div>';
        }
    }

    function renderCards() {
        const container = document.getElementById('cardContainer');
        container.innerHTML = '';
        chemicals.forEach((item, idx) => {
            const card = document.createElement('div');
            card.className = "relative rounded-xl shadow-md hover:shadow-xl text-center storage-card bg-white border border-gray-200 hover:border-indigo-300 text-gray-800 transition-all duration-200 cursor-pointer transform hover:scale-105 flex flex-col justify-between items-center p-4";
            card.style.minHeight = "180px";
            card.style.height = "100%";
            card.dataset.idx = idx;
            card.innerHTML = `
                <div class="flex flex-col flex-1 justify-center items-center w-full h-full">
                    <div class="flex items-center justify-center w-full flex-1">
                        <div class="w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-indigo-400 to-blue-500 rounded-lg flex items-center justify-center shadow-md">
                            <svg class="w-8 h-8 sm:w-10 sm:h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="flex-1 flex items-center justify-center w-full">
                        <h3 class="text-sm sm:text-base font-semibold text-gray-900 mb-2 line-clamp-2 leading-tight text-center w-full">
                            ${item.name}
                        </h3>
                    </div>
                </div>
            `;
            card.addEventListener('click', () => {
                if (printMode) {
                    showBarcodeListPopup(item);
                }
            });
            container.appendChild(card);
        });
    }

    // Popup แสดงบาร์โค้ดทั้งหมดของสารนั้น
    async function showBarcodeListPopup(item) {
        try {
            const res = await fetch(`/Barcode/name/${encodeURIComponent(item.name)}`);
            const data = await res.json();
            const barcodes = Array.isArray(data.data) ? data.data : [];
            if (barcodes.length === 0) {
                Swal.fire({
                    title: 'No barcode found',
                    text: 'สารนี้ยังไม่มีบาร์โค้ด',
                    icon: 'warning',
                    confirmButtonText: 'OK'
                });
                return;
            }
            let html = '<div class="grid grid-cols-1 gap-3">';
            barcodes.forEach((bc, i) => {
                html += `
                    <div class="rounded-lg border border-indigo-300 bg-indigo-50 p-3 mb-2 cursor-pointer hover:bg-indigo-100 transition" style="display:flex;align-items:center;gap:1rem;" onclick="window.selectBarcodeForPrint('${encodeURIComponent(item.name)}','${encodeURIComponent(bc.barcode)}')">
                        <span class="font-mono text-lg text-blue-900 bg-white p-2 rounded border">${bc.barcode || '-'}</span>
                    </div>
                `;
            });
            html += '</div>';
            Swal.fire({
                title: `เลือกบาร์โค้ดของ ${item.name}`,
                html: html,
                showCancelButton: true,
                showConfirmButton: false,
                cancelButtonText: 'ยกเลิก',
                width: 500
            });
            // Attach global function for barcode selection
            window.selectBarcodeForPrint = function(name, barcode) {
                showPrintPopup(decodeURIComponent(name), decodeURIComponent(barcode));
            }
        } catch (e) {
            Swal.fire('Error', 'ไม่สามารถโหลดบาร์โค้ดได้', 'error');
        }
    }

    // Popup แสดงรายละเอียดบาร์โค้ดและยืนยัน
    function showPrintPopup(name, barcode) {
        Swal.fire({
            title: 'Print Barcode',
            html: `
                <div class="text-left space-y-3">
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <div class="font-semibold text-gray-700 mb-1">ชื่อสารเคมี:</div>
                        <div class="text-gray-900">${name}</div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg">
                        <div class="font-semibold text-blue-700 mb-1">บาร์โค้ด:</div>
                        <div class="font-mono text-lg text-blue-900 bg-white p-2 rounded border">${barcode || '-'}</div>
                    </div>
                </div>
            `,
            showCancelButton: true,
            confirmButtonText: 'ยืนยัน',
            cancelButtonText: 'ยกเลิก',
            confirmButtonColor: '#3b82f6',
            cancelButtonColor: '#6b7280'
        }).then(result => {
            if (result.isConfirmed) {
                window.Printing_barcode = barcode;
                Swal.fire({
                    title: 'Ready to print!',
                    text: `Barcode ${barcode} is set for printing.`,
                    icon: 'success',
                    confirmButtonText: 'OK'
                });
                printMode = false;
            } else {
                printMode = false;
            }
        });
    }

    document.getElementById('printBtn').addEventListener('click', async () => {
        const result = await Swal.fire({
            title: 'Are you sure you want to print the barcode?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'Print',
            cancelButtonText: 'Cancel',
            confirmButtonColor: '#3b82f6',
            cancelButtonColor: '#6b7280'
        });
        if (result.isConfirmed) {
            printMode = true;
            Swal.fire({
                title: 'Select a chemical card to print',
                text: 'Click on a card to choose the chemical you want to print.',
                icon: 'info',
                confirmButtonText: 'OK',
                allowOutsideClick: false
            });
        }
    });

    fetchChemicals();
    </script>
</body>
</html>
